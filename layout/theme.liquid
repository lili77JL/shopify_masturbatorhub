<!doctype html>

{%- assign direction = 'ltr' -%}
{%- case request.locale.iso_code -%}
  {%- when 'ar', 'arc', 'dv', 'fa', 'ha', 'he', 'kwh', 'ks', 'ku', 'ps', 'ur', 'yi' -%}
    {%- assign direction = 'rtl' -%}
{%- endcase -%}

<html class="no-js" lang="{{ request.locale.iso_code }}" dir="{{ direction }}">
  <head>
    <meta charset="UTF-8">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, maximum-scale=1.0"
    >
    <meta name="theme-color" content="{{ settings.header_background }}">

    {% comment %}
      Block users that use Chinese browsers.
    {% endcomment %}
    {% if settings.block_cn_browser %}
      {% render 'block-chinese-browser' %}
    {% endif %}

    {% comment %}
      Disable right-clicking.
    {% endcomment %}
    {% if settings.block_right_mouse %}
      <script>
        window.oncontextmenu = function (e) {
          e.preventDefault();
        };
      </script>
    {% endif %}

    {% comment %}
      Block users from Mainland China or Hong Kong from accessing the website.
    {% endcomment %}
    {% if settings.block_cn_hk_ips %}
      {% render 'block-cn-hk' %}
    {% endif %}

    <title>
      {% if page_title == blank -%}
        {{- shop.name -}}
      {%- else -%}
        {{- page_title -}}
        {%- if current_page != 1 %} &ndash; {{ 'general.meta.page' | t: page: current_page }}{% endif -%}
      {%- endif %}
    </title>

    {%- if page_description -%}
      <meta name="description" content="{{ page_description | escape }}">
    {%- endif -%}

    <link rel="canonical" href="{{ canonical_url }}">

    {%- if settings.favicon -%}
      <link rel="shortcut icon" href="{{ settings.favicon | image_url: width: 96, height: 96 }}" type="image/png">
    {%- endif -%}

    {%- comment -%}
      Few prefech to increase performance on commonly used third-parties.
    {%- endcomment -%}
    <link rel="preconnect" href="https://cdn.shopify.com">
    <link rel="dns-prefetch" href="https://productreviews.shopifycdn.com">
    <link rel="dns-prefetch" href="https://www.google-analytics.com">

    {%- comment -%}
      Google Fonts.
    {%- endcomment -%}
    {% # theme-check-disable RemoteAsset %}
    {%- if settings.heading_font_google != blank -%}
      <link
        href="https://fonts.googleapis.com/css2?family={{ settings.heading_font_google }}&display=swap"
        rel="stylesheet preconnect"
      >
    {%- endif -%}
    {%- if settings.text_font_google != blank -%}
      <link
        href="https://fonts.googleapis.com/css2?family={{ settings.text_font_google }}&display=swap"
        rel="stylesheet preconnect"
      >
    {%- endif -%}
    {% # theme-check-enable RemoteAsset %}

    {%- if settings.heading_font_google == blank
      and settings.heading_font.system? == false
      or settings.text_font_google == blank
      and settings.text_font.system? == false
    -%}
      <link rel="preconnect" href="https://fonts.shopifycdn.com" crossorigin>
    {%- endif -%}

    {%- comment -%}
      Preload important resources.
    {%- endcomment -%}
    <link rel="preload" as="style" href="{{ 'theme.css' | asset_url }}">
    <link rel="preload" as="script" href="{{ 'vendor.js' | asset_url }}">
    <link rel="preload" as="script" href="{{ 'theme.js' | asset_url }}">

    {%- comment -%}
      IMPLEMENTATION NOTE: for improving performance, Zalify tries to preload images on known pages (such as blog page, product or collection pages). In order to keep a main JS file size minimal, the theme also lazyloads non-essential libraries (such as PhotoSwipe or Flickity) and only loads them on demand.
    {%- endcomment -%}
    {%- if request.page_type == 'product' -%}
      {%- assign selected_media = product.selected_variant.featured_media | default: product.featured_media -%}

      <link rel="preload" as="fetch" href="{{ product.url }}.js" crossorigin>
      <link
        rel="preload"
        as="image"
        imagesizes="(max-width: 999px) calc(100vw - 48px), 640px"
        imagesrcset="{% render 'image-attributes', image: selected_media, sizes: '400,500,600,700,800,900,1000,1100,1200,1300,1400,1500,1600,1700,1800', sizes_only: true %}"
      >

      {%- if product.media.size > 1 -%}
        <link rel="preload" as="script" href="{{ 'flickity.js' | asset_url }}">
      {%- endif -%}
    {%- elsif request.page_type == 'collection' and collection.image -%}
      <link
        rel="preload"
        as="image"
        media="(max-width: 740px)"
        imagesizes="100vw"
        imagesrcset="{% render 'image-attributes', image: collection.image, sizes: '400,500,600,700,800,900,1000', height_constraint: 600, crop: 'center', sizes_only: true %}"
      >
      <link
        rel="preload"
        as="image"
        media="(min-width: 741px)"
        imagesizes="100vw"
        imagesrcset="{% render 'image-attributes', image: collection.image, sizes: '600,700,800,1000,1200,1400,1600,1800,2000,2200,2400,2600', sizes_only: true %}"
      >
    {%- endif -%}

    {% render 'social-meta-tags' %}
    {% render 'microdata-schema' %}
    {% render 'css-variables', direction: direction %}
    {% render 'js-variables', direction: direction %}

    <link rel="stylesheet" href="{{ 'theme.css' | asset_url }}">

    <script src="{{ 'vendor.js' | asset_url }}" defer></script>
    <script src="{{ 'theme.js' | asset_url }}" defer></script>
    <script src="{{ 'custom.js' | asset_url }}" defer></script>

    {%- if request.design_mode -%}
      <script src="{{ 'zalify-video-widgets.js' | asset_url }}" defer></script>
    {%- endif -%}

    {%- if settings.paypal_client_id != blank -%}
      {% # theme-check-disable RemoteAsset %}
      <script
        src="https://www.paypal.com/sdk/js?client-id={{ settings.paypal_client_id }}&components=buttons&currency={{ cart.currency.iso_code }}"
        defer
      ></script>
      {% # theme-check-enable RemoteAsset %}
    {%- endif -%}

    {{ content_for_header }}
  </head>

  {%- assign feature_classes = '' -%}
  {%- if settings.show_image_zoom -%}
    {% assign feature_classes = feature_classes | append: ' features--image-zoom' %}
  {%- endif -%}

  <body
    class="no-focus-outline {{ feature_classes }}"
    data-instant-allow-query-string
  >
    {%- comment -%}
      Common SVG definitions that we are re-using in several places.
    {%- endcomment -%}
    <svg class="visually-hidden">
      <linearGradient id="rating-star-gradient-half">
        <stop offset="50%" stop-color="rgb(var(--product-star-rating))" />
        <stop offset="50%" stop-color="rgb(var(--product-star-rating))" stop-opacity="0.4" />
      </linearGradient>
    </svg>

    <a href="#main" class="visually-hidden skip-to-content">{{ 'general.accessibility.skip_to_content' | t }}</a>
    <loading-bar class="loading-bar"></loading-bar>

    {%- if request.page_type != 'gift_card'
      and request.page_type != 'password'
      and request.path != settings.unavailable_page.url
    -%}
      {%- section 'back-to-top' -%}
      {%- section 'announcement-bar' -%}
      {%- section 'popup' -%}
      {%- section 'video-bubble' -%}
      {%- section 'video-bubble-v2' -%}
      {%- section 'header' -%}

      {%- unless settings.cart_type == 'page' or request.page_type == 'cart' -%}
        {%- section 'mini-cart' -%}
      {%- endunless -%}
    {%- endif -%}

    <div id="main" role="main" class="anchor">
      {%- comment -%}
        IMPLEMENTATION NOTE: on collection and search page, the theme was designed to show on mobile the filter bar and/or sort by at the very top of the page. However, due to the fact that sections are isolated, I had to move the code here. Then, the collection section, based on the selected settings, will eventually hide those elements in CSS.
      {%- endcomment -%}
      {%- if request.page_type == 'collection' or request.page_type == 'search' -%}
        {%- assign active_filters_count = 0 -%}

        {%- if request.page_type == 'collection' -%}
          {%- assign filters = collection.filters -%}
        {%- else -%}
          {%- assign filters = search.filters -%}
        {%- endif -%}

        {%- for filter in filters -%}
          {%- if filter.type == 'list' -%}
            {%- assign active_filters_count = active_filters_count | plus: filter.active_values.size -%}
          {%- elsif filter.type == 'price_range' and filter.min_value.value or filter.max_value.value -%}
            {%- assign active_filters_count = active_filters_count | plus: 1 -%}
          {%- endif -%}
        {%- endfor -%}

        {%- assign is_toolbar_collapsed = false -%}

        {%- if request.page_type == 'search'
          and search.results.first.object_type != 'product'
          and search.results_count > 0
        -%}
          {%- assign is_toolbar_collapsed = true -%}
        {%- endif -%}

        <div
          id="mobile-facet-toolbar"
          class="mobile-toolbar {% if is_toolbar_collapsed %}is-collapsed{% endif %} hidden-lap-and-up"
        >
          <button
            is="toggle-button"
            class="mobile-toolbar__item mobile-toolbar__item--filters {% if active_filters_count > 0 %}has-filters{% endif %}"
            aria-expanded="false"
            aria-controls="facet-filters"
            style="display: none"
          >
            {%- render 'icon' with 'filters' -%}
            <span class="mobile-toolbar__item-label">{{- 'collection.general.filters' | t -}}</span>
          </button>

          <button
            is="toggle-button"
            class="mobile-toolbar__item mobile-toolbar__item--sort"
            aria-expanded="false"
            aria-controls="sort-by-popover"
            style="display: none"
          >
            <span class="mobile-toolbar__item-label">{{- 'collection.general.sort_by' | t -}}</span>
            {%- render 'icon' with 'chevron' -%}
          </button>
        </div>
      {%- endif -%}

      {{ content_for_layout }}

      {%- unless request.page_type == 'index' or request.page_type == 'password' or request.page_type == 'gift_card' -%}
        {%- section 'static-text-with-icons' -%}
        {%- section 'static-newsletter' -%}
      {%- endunless -%}
    </div>

    {%- if request.page_type != 'gift_card'
      and request.page_type != 'password'
      and request.path != settings.unavailable_page.url
    -%}
      {%- section 'footer' -%}
      {%- section 'footer-navigation' -%}
      {%- section 'color-swatch-patterns' -%}
    {%- endif -%}

    {%- render 'activate-popup' -%}
  </body>
</html>
